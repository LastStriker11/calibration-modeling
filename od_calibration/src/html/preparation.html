<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>preparation API documentation</title>
<meta name="description" content="A module for paths (e.g., path to SUMO, path to network) and data (e.g., prior OD estimates, observed traffic measurements) prepartion â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>preparation</code></h1>
</header>
<section id="section-intro">
<p>A module for paths (e.g., path to SUMO, path to network) and data (e.g., prior OD estimates, observed traffic measurements) prepartion.</p>
<p>@author: Qing-Long Lu (qinglong.lu@tum.de)</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
&#34;&#34;&#34;
A module for paths (e.g., path to SUMO, path to network) and data (e.g., prior OD estimates, observed traffic measurements) prepartion.

@author: Qing-Long Lu (qinglong.lu@tum.de)
&#34;&#34;&#34;
import pandas as pd
import numpy as np
import os
import shutil

class DataPreparation(object):
    def __init__(
            self, 
            paths,
            sumo_var
            ):
        &#39;&#39;&#39;
        Initialize a DataPreparation object, with `paths` (a dict of paths to the network, SUMO, scenario and cache) 
        and `sumo_var` (a dict of SUMO simulation configuration) as necessary attributes.

        Parameters
        ----------
        paths : dict
            A dict of paths to SUMO, network, measurements, demand and cache, including:
                &lt;table&gt;
                    &lt;thead&gt;
                        &lt;tr&gt;
                            &lt;th align=&#34;left&#34;&gt;Variable&lt;/th&gt;
                            &lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
                        &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;sumo&#39;&lt;/td&gt;
                            &lt;td&gt;path to the SUMO installation location.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;network&#39;&lt;/td&gt;
                            &lt;td&gt;path to the SUMO network files.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;demand&#39;&lt;/td&gt;
                            &lt;td&gt;path to the prior OD estimates in the [O-format (VISUM/VISSUM)](https://sumo.dlr.de/docs/Demand/Importing_O/D_Matrices.html).&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;measurements&#39;&lt;/td&gt;
                            &lt;td&gt;path to the true traffic measurements (in `.csv` format).&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;cache&#39;&lt;/td&gt;
                            &lt;td&gt;path to cache folder.&lt;/td&gt;
                        &lt;/tr&gt;
                    &lt;/tbody&gt;
                &lt;/table&gt;
        sumo_var : dict
            A dict of SUMO simulation setups, including:
                &lt;table&gt;
                    &lt;thead&gt;
                        &lt;tr&gt;
                            &lt;th align=&#34;left&#34;&gt;Variable&lt;/th&gt;
                            &lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
                        &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;network&#39;&lt;/td&gt;
                            &lt;td&gt;name of the network file.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;tazname&#39;&lt;/td&gt;
                            &lt;td&gt;name of the traffic analysis zone (TAZ) file.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;add_file&#39;&lt;/td&gt;
                            &lt;td&gt;name of the additional file, which includes the detectors information.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;starttime&#39;&lt;/td&gt;
                            &lt;td&gt;when the simulation should start.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;endtime&#39;&lt;/td&gt;
                            &lt;td&gt;when the simulation should stop.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;objective&#39;&lt;/td&gt;
                            &lt;td&gt;indicate the traffic measurements to use, &#39;counts&#39; or &#39;time&#39;.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;interval&#39;&lt;/td&gt;
                            &lt;td&gt;calibration interval (in common with the resolution of traffic measurements).&lt;/td&gt;
                        &lt;/tr&gt;
                    &lt;/tbody&gt;
                &lt;/table&gt;

        Returns
        -------
        None.

        &#39;&#39;&#39;
        self.paths = paths
        self.sumo_var = sumo_var
    
    def load_path(self):
        &#39;&#39;&#39;
        Copy necessary files to the cache folder. Simulations and calibration 
        are carried out in this folder to aviod the intermediate data generated by SUMO
        mess up the original network and scenario folders.

        Returns
        -------
        None.

        &#39;&#39;&#39;
        self.sumo_var[&#39;od_prior&#39;] = [f for f in os.listdir(self.paths[&#39;demand&#39;])]
        self.sumo_var[&#39;od_prior&#39;].sort()
        self.sumo_var[&#39;truedata&#39;] = [f for f in os.listdir(self.paths[&#39;measurements&#39;])]
        self.sumo_var[&#39;truedata&#39;].sort()
        
        # create the folder to store the scenario files
        # if os.path.exists(self.paths[&#34;cache&#34;]):
        #     shutil.rmtree(self.paths[&#34;cache&#34;])
        #     os.mkdir(self.paths[&#34;cache&#34;])
        if not os.path.exists(self.paths[&#34;cache&#34;]):
            os.mkdir(self.paths[&#34;cache&#34;])
        #% Start Simulation Times
        integ= np.floor(np.double(self.sumo_var[&#34;starttime&#34;]))
        fract=100*(np.double(self.sumo_var[&#34;starttime&#34;])-integ)
        beginSim = int(integ*60*60 + fract*60)
        #% End Simulation Times
        integ=np.floor(np.double(self.sumo_var[&#34;endtime&#34;]))
        fract=100*(np.double(self.sumo_var[&#34;endtime&#34;])-integ)
        endSim = int(integ*60*60 + fract*60)
        
        self.sumo_var[&#39;beginSimTime&#39;] =  str(beginSim)
        self.sumo_var[&#39;endSimTime&#39;]   =  str(endSim+500)
        
        &#39;&#39;&#39;
         copy relevant files for SUMO simulation to a folder under the temp directory,
         so that all output files will be located in a same folder which won&#39;t make the
         original network folder dirty and give us convenienc to deal with the temporary
         outputs which could be redundant.
        &#39;&#39;&#39;
        # network
        old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;network&#39;]
        new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;network&#39;]
        shutil.copyfile(old_loc, new_loc)
        # taz
        old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;tazname&#39;]
        new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;tazname&#39;]
        shutil.copyfile(old_loc, new_loc)
        # additional
        old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;add_file&#39;]
        new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;add_file&#39;]
        shutil.copyfile(old_loc, new_loc)
        # prior od estimates
        for file in self.sumo_var[&#34;od_prior&#34;]:
            old_loc = self.paths[&#39;demand&#39;]+file
            new_loc = self.paths[&#39;cache&#39;]+file
            shutil.copyfile(old_loc, new_loc)
        # truedata
        for file in self.sumo_var[&#39;truedata&#39;]:
            old_loc = self.paths[&#39;measurements&#39;]+file
            new_loc = self.paths[&#39;cache&#39;]+file
            shutil.copyfile(old_loc, new_loc)            
        
    def load_data(self):
        &#39;&#39;&#39;
        Load the od_prior estimates and traffic measurements.

        Returns
        -------
        data : TYPE
            DESCRIPTION.
        od_prior : TYPE
            DESCRIPTION.

        &#39;&#39;&#39;
        start = int(float(self.sumo_var[&#34;starttime&#34;]))
        end = int(float(self.sumo_var[&#39;endtime&#39;]))
        cols = list(range(start, end))
        cols_inter = list(np.arange(start, end, self.sumo_var[&#39;interval&#39;]))
        data = pd.DataFrame()
        # for counts
        if self.sumo_var[&#39;objective&#39;] == &#39;counts&#39;:
            for i in range(len(self.sumo_var[&#34;truedata&#34;])):
                temp_data = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#39;truedata&#39;][i], header=None)
                temp_data.set_index(0, inplace=True)
                data = pd.concat([data, temp_data], axis=1)
            data.columns = cols_inter
            #@@@@
            data = data[(data.T!=0).any()]
            #@@@@
        # for travel time
        if self.sumo_var[&#39;objective&#39;] == &#39;time&#39;:
            for i in range(len(self.sumo_var[&#34;truedata&#34;])):
                temp_data = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#39;truedata&#39;][i], header=None)
                temp_data[&#39;label&#39;] = list(zip(temp_data.iloc[:,0], temp_data.iloc[:,1]))
                temp_data.drop([0,1], axis=1, inplace=True)
                temp_data.set_index(&#39;label&#39;, inplace=True)
                data = pd.concat([data, temp_data], axis=1)
            data.columns = cols
        # prior od estimates
        od_prior = pd.DataFrame()
        for i in range(len(self.sumo_var[&#34;od_prior&#34;])):
            temp_od = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#34;od_prior&#34;][i], sep=&#39;\s+&#39;, header=None, skiprows=5)
            od_prior = pd.concat([od_prior, temp_od.iloc[:,2]], axis=1)
        od_prior.columns = cols_inter
        od_prior = pd.concat([temp_od.iloc[:,:2], od_prior], axis=1)
        return data, od_prior


        </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="preparation.DataPreparation"><code class="flex name class">
<span>class <span class="ident">DataPreparation</span></span>
<span>(</span><span>paths, sumo_var)</span>
</code></dt>
<dd>
<div class="desc"><p>Initialize a DataPreparation object, with <code>paths</code> (a dict of paths to the network, SUMO, scenario and cache)
and <code>sumo_var</code> (a dict of SUMO simulation configuration) as necessary attributes.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>paths</code></strong> :&ensp;<code>dict</code></dt>
<dd>A dict of paths to SUMO, network, measurements, demand and cache, including:
<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>'sumo'</td>
<td>path to the SUMO installation location.</td>
</tr>
<tr>
<td>'network'</td>
<td>path to the SUMO network files.</td>
</tr>
<tr>
<td>'demand'</td>
<td>path to the prior OD estimates in the <a href="https://sumo.dlr.de/docs/Demand/Importing_O/D_Matrices.html">O-format (VISUM/VISSUM)</a>.</td>
</tr>
<tr>
<td>'measurements'</td>
<td>path to the true traffic measurements (in <code>.csv</code> format).</td>
</tr>
<tr>
<td>'cache'</td>
<td>path to cache folder.</td>
</tr>
</tbody>
</table></dd>
<dt><strong><code>sumo_var</code></strong> :&ensp;<code>dict</code></dt>
<dd>A dict of SUMO simulation setups, including:
<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>'network'</td>
<td>name of the network file.</td>
</tr>
<tr>
<td>'tazname'</td>
<td>name of the traffic analysis zone (TAZ) file.</td>
</tr>
<tr>
<td>'add_file'</td>
<td>name of the additional file, which includes the detectors information.</td>
</tr>
<tr>
<td>'starttime'</td>
<td>when the simulation should start.</td>
</tr>
<tr>
<td>'endtime'</td>
<td>when the simulation should stop.</td>
</tr>
<tr>
<td>'objective'</td>
<td>indicate the traffic measurements to use, 'counts' or 'time'.</td>
</tr>
<tr>
<td>'interval'</td>
<td>calibration interval (in common with the resolution of traffic measurements).</td>
</tr>
</tbody>
</table></dd>
</dl>
<h2 id="returns">Returns</h2>
<p>None.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class DataPreparation(object):
    def __init__(
            self, 
            paths,
            sumo_var
            ):
        &#39;&#39;&#39;
        Initialize a DataPreparation object, with `paths` (a dict of paths to the network, SUMO, scenario and cache) 
        and `sumo_var` (a dict of SUMO simulation configuration) as necessary attributes.

        Parameters
        ----------
        paths : dict
            A dict of paths to SUMO, network, measurements, demand and cache, including:
                &lt;table&gt;
                    &lt;thead&gt;
                        &lt;tr&gt;
                            &lt;th align=&#34;left&#34;&gt;Variable&lt;/th&gt;
                            &lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
                        &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;sumo&#39;&lt;/td&gt;
                            &lt;td&gt;path to the SUMO installation location.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;network&#39;&lt;/td&gt;
                            &lt;td&gt;path to the SUMO network files.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;demand&#39;&lt;/td&gt;
                            &lt;td&gt;path to the prior OD estimates in the [O-format (VISUM/VISSUM)](https://sumo.dlr.de/docs/Demand/Importing_O/D_Matrices.html).&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;measurements&#39;&lt;/td&gt;
                            &lt;td&gt;path to the true traffic measurements (in `.csv` format).&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;cache&#39;&lt;/td&gt;
                            &lt;td&gt;path to cache folder.&lt;/td&gt;
                        &lt;/tr&gt;
                    &lt;/tbody&gt;
                &lt;/table&gt;
        sumo_var : dict
            A dict of SUMO simulation setups, including:
                &lt;table&gt;
                    &lt;thead&gt;
                        &lt;tr&gt;
                            &lt;th align=&#34;left&#34;&gt;Variable&lt;/th&gt;
                            &lt;th align=&#34;left&#34;&gt;Description&lt;/th&gt;
                        &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;network&#39;&lt;/td&gt;
                            &lt;td&gt;name of the network file.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;tazname&#39;&lt;/td&gt;
                            &lt;td&gt;name of the traffic analysis zone (TAZ) file.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;add_file&#39;&lt;/td&gt;
                            &lt;td&gt;name of the additional file, which includes the detectors information.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;starttime&#39;&lt;/td&gt;
                            &lt;td&gt;when the simulation should start.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;endtime&#39;&lt;/td&gt;
                            &lt;td&gt;when the simulation should stop.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;objective&#39;&lt;/td&gt;
                            &lt;td&gt;indicate the traffic measurements to use, &#39;counts&#39; or &#39;time&#39;.&lt;/td&gt;
                        &lt;/tr&gt;
                        &lt;tr&gt;
                            &lt;td&gt;&#39;interval&#39;&lt;/td&gt;
                            &lt;td&gt;calibration interval (in common with the resolution of traffic measurements).&lt;/td&gt;
                        &lt;/tr&gt;
                    &lt;/tbody&gt;
                &lt;/table&gt;

        Returns
        -------
        None.

        &#39;&#39;&#39;
        self.paths = paths
        self.sumo_var = sumo_var
    
    def load_path(self):
        &#39;&#39;&#39;
        Copy necessary files to the cache folder. Simulations and calibration 
        are carried out in this folder to aviod the intermediate data generated by SUMO
        mess up the original network and scenario folders.

        Returns
        -------
        None.

        &#39;&#39;&#39;
        self.sumo_var[&#39;od_prior&#39;] = [f for f in os.listdir(self.paths[&#39;demand&#39;])]
        self.sumo_var[&#39;od_prior&#39;].sort()
        self.sumo_var[&#39;truedata&#39;] = [f for f in os.listdir(self.paths[&#39;measurements&#39;])]
        self.sumo_var[&#39;truedata&#39;].sort()
        
        # create the folder to store the scenario files
        # if os.path.exists(self.paths[&#34;cache&#34;]):
        #     shutil.rmtree(self.paths[&#34;cache&#34;])
        #     os.mkdir(self.paths[&#34;cache&#34;])
        if not os.path.exists(self.paths[&#34;cache&#34;]):
            os.mkdir(self.paths[&#34;cache&#34;])
        #% Start Simulation Times
        integ= np.floor(np.double(self.sumo_var[&#34;starttime&#34;]))
        fract=100*(np.double(self.sumo_var[&#34;starttime&#34;])-integ)
        beginSim = int(integ*60*60 + fract*60)
        #% End Simulation Times
        integ=np.floor(np.double(self.sumo_var[&#34;endtime&#34;]))
        fract=100*(np.double(self.sumo_var[&#34;endtime&#34;])-integ)
        endSim = int(integ*60*60 + fract*60)
        
        self.sumo_var[&#39;beginSimTime&#39;] =  str(beginSim)
        self.sumo_var[&#39;endSimTime&#39;]   =  str(endSim+500)
        
        &#39;&#39;&#39;
         copy relevant files for SUMO simulation to a folder under the temp directory,
         so that all output files will be located in a same folder which won&#39;t make the
         original network folder dirty and give us convenienc to deal with the temporary
         outputs which could be redundant.
        &#39;&#39;&#39;
        # network
        old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;network&#39;]
        new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;network&#39;]
        shutil.copyfile(old_loc, new_loc)
        # taz
        old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;tazname&#39;]
        new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;tazname&#39;]
        shutil.copyfile(old_loc, new_loc)
        # additional
        old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;add_file&#39;]
        new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;add_file&#39;]
        shutil.copyfile(old_loc, new_loc)
        # prior od estimates
        for file in self.sumo_var[&#34;od_prior&#34;]:
            old_loc = self.paths[&#39;demand&#39;]+file
            new_loc = self.paths[&#39;cache&#39;]+file
            shutil.copyfile(old_loc, new_loc)
        # truedata
        for file in self.sumo_var[&#39;truedata&#39;]:
            old_loc = self.paths[&#39;measurements&#39;]+file
            new_loc = self.paths[&#39;cache&#39;]+file
            shutil.copyfile(old_loc, new_loc)            
        
    def load_data(self):
        &#39;&#39;&#39;
        Load the od_prior estimates and traffic measurements.

        Returns
        -------
        data : TYPE
            DESCRIPTION.
        od_prior : TYPE
            DESCRIPTION.

        &#39;&#39;&#39;
        start = int(float(self.sumo_var[&#34;starttime&#34;]))
        end = int(float(self.sumo_var[&#39;endtime&#39;]))
        cols = list(range(start, end))
        cols_inter = list(np.arange(start, end, self.sumo_var[&#39;interval&#39;]))
        data = pd.DataFrame()
        # for counts
        if self.sumo_var[&#39;objective&#39;] == &#39;counts&#39;:
            for i in range(len(self.sumo_var[&#34;truedata&#34;])):
                temp_data = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#39;truedata&#39;][i], header=None)
                temp_data.set_index(0, inplace=True)
                data = pd.concat([data, temp_data], axis=1)
            data.columns = cols_inter
            #@@@@
            data = data[(data.T!=0).any()]
            #@@@@
        # for travel time
        if self.sumo_var[&#39;objective&#39;] == &#39;time&#39;:
            for i in range(len(self.sumo_var[&#34;truedata&#34;])):
                temp_data = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#39;truedata&#39;][i], header=None)
                temp_data[&#39;label&#39;] = list(zip(temp_data.iloc[:,0], temp_data.iloc[:,1]))
                temp_data.drop([0,1], axis=1, inplace=True)
                temp_data.set_index(&#39;label&#39;, inplace=True)
                data = pd.concat([data, temp_data], axis=1)
            data.columns = cols
        # prior od estimates
        od_prior = pd.DataFrame()
        for i in range(len(self.sumo_var[&#34;od_prior&#34;])):
            temp_od = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#34;od_prior&#34;][i], sep=&#39;\s+&#39;, header=None, skiprows=5)
            od_prior = pd.concat([od_prior, temp_od.iloc[:,2]], axis=1)
        od_prior.columns = cols_inter
        od_prior = pd.concat([temp_od.iloc[:,:2], od_prior], axis=1)
        return data, od_prior</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="preparation.DataPreparation.load_data"><code class="name flex">
<span>def <span class="ident">load_data</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Load the od_prior estimates and traffic measurements.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>TYPE</code></dt>
<dd>DESCRIPTION.</dd>
<dt><strong><code>od_prior</code></strong> :&ensp;<code>TYPE</code></dt>
<dd>DESCRIPTION.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_data(self):
    &#39;&#39;&#39;
    Load the od_prior estimates and traffic measurements.

    Returns
    -------
    data : TYPE
        DESCRIPTION.
    od_prior : TYPE
        DESCRIPTION.

    &#39;&#39;&#39;
    start = int(float(self.sumo_var[&#34;starttime&#34;]))
    end = int(float(self.sumo_var[&#39;endtime&#39;]))
    cols = list(range(start, end))
    cols_inter = list(np.arange(start, end, self.sumo_var[&#39;interval&#39;]))
    data = pd.DataFrame()
    # for counts
    if self.sumo_var[&#39;objective&#39;] == &#39;counts&#39;:
        for i in range(len(self.sumo_var[&#34;truedata&#34;])):
            temp_data = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#39;truedata&#39;][i], header=None)
            temp_data.set_index(0, inplace=True)
            data = pd.concat([data, temp_data], axis=1)
        data.columns = cols_inter
        #@@@@
        data = data[(data.T!=0).any()]
        #@@@@
    # for travel time
    if self.sumo_var[&#39;objective&#39;] == &#39;time&#39;:
        for i in range(len(self.sumo_var[&#34;truedata&#34;])):
            temp_data = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#39;truedata&#39;][i], header=None)
            temp_data[&#39;label&#39;] = list(zip(temp_data.iloc[:,0], temp_data.iloc[:,1]))
            temp_data.drop([0,1], axis=1, inplace=True)
            temp_data.set_index(&#39;label&#39;, inplace=True)
            data = pd.concat([data, temp_data], axis=1)
        data.columns = cols
    # prior od estimates
    od_prior = pd.DataFrame()
    for i in range(len(self.sumo_var[&#34;od_prior&#34;])):
        temp_od = pd.read_csv(self.paths[&#34;cache&#34;] + self.sumo_var[&#34;od_prior&#34;][i], sep=&#39;\s+&#39;, header=None, skiprows=5)
        od_prior = pd.concat([od_prior, temp_od.iloc[:,2]], axis=1)
    od_prior.columns = cols_inter
    od_prior = pd.concat([temp_od.iloc[:,:2], od_prior], axis=1)
    return data, od_prior</code></pre>
</details>
</dd>
<dt id="preparation.DataPreparation.load_path"><code class="name flex">
<span>def <span class="ident">load_path</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Copy necessary files to the cache folder. Simulations and calibration
are carried out in this folder to aviod the intermediate data generated by SUMO
mess up the original network and scenario folders.</p>
<h2 id="returns">Returns</h2>
<p>None.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_path(self):
    &#39;&#39;&#39;
    Copy necessary files to the cache folder. Simulations and calibration 
    are carried out in this folder to aviod the intermediate data generated by SUMO
    mess up the original network and scenario folders.

    Returns
    -------
    None.

    &#39;&#39;&#39;
    self.sumo_var[&#39;od_prior&#39;] = [f for f in os.listdir(self.paths[&#39;demand&#39;])]
    self.sumo_var[&#39;od_prior&#39;].sort()
    self.sumo_var[&#39;truedata&#39;] = [f for f in os.listdir(self.paths[&#39;measurements&#39;])]
    self.sumo_var[&#39;truedata&#39;].sort()
    
    # create the folder to store the scenario files
    # if os.path.exists(self.paths[&#34;cache&#34;]):
    #     shutil.rmtree(self.paths[&#34;cache&#34;])
    #     os.mkdir(self.paths[&#34;cache&#34;])
    if not os.path.exists(self.paths[&#34;cache&#34;]):
        os.mkdir(self.paths[&#34;cache&#34;])
    #% Start Simulation Times
    integ= np.floor(np.double(self.sumo_var[&#34;starttime&#34;]))
    fract=100*(np.double(self.sumo_var[&#34;starttime&#34;])-integ)
    beginSim = int(integ*60*60 + fract*60)
    #% End Simulation Times
    integ=np.floor(np.double(self.sumo_var[&#34;endtime&#34;]))
    fract=100*(np.double(self.sumo_var[&#34;endtime&#34;])-integ)
    endSim = int(integ*60*60 + fract*60)
    
    self.sumo_var[&#39;beginSimTime&#39;] =  str(beginSim)
    self.sumo_var[&#39;endSimTime&#39;]   =  str(endSim+500)
    
    &#39;&#39;&#39;
     copy relevant files for SUMO simulation to a folder under the temp directory,
     so that all output files will be located in a same folder which won&#39;t make the
     original network folder dirty and give us convenienc to deal with the temporary
     outputs which could be redundant.
    &#39;&#39;&#39;
    # network
    old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;network&#39;]
    new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;network&#39;]
    shutil.copyfile(old_loc, new_loc)
    # taz
    old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;tazname&#39;]
    new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;tazname&#39;]
    shutil.copyfile(old_loc, new_loc)
    # additional
    old_loc = self.paths[&#39;network&#39;]+self.sumo_var[&#39;add_file&#39;]
    new_loc = self.paths[&#39;cache&#39;]+self.sumo_var[&#39;add_file&#39;]
    shutil.copyfile(old_loc, new_loc)
    # prior od estimates
    for file in self.sumo_var[&#34;od_prior&#34;]:
        old_loc = self.paths[&#39;demand&#39;]+file
        new_loc = self.paths[&#39;cache&#39;]+file
        shutil.copyfile(old_loc, new_loc)
    # truedata
    for file in self.sumo_var[&#39;truedata&#39;]:
        old_loc = self.paths[&#39;measurements&#39;]+file
        new_loc = self.paths[&#39;cache&#39;]+file
        shutil.copyfile(old_loc, new_loc)            </code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="preparation.DataPreparation" href="#preparation.DataPreparation">DataPreparation</a></code></h4>
<ul class="">
<li><code><a title="preparation.DataPreparation.load_data" href="#preparation.DataPreparation.load_data">load_data</a></code></li>
<li><code><a title="preparation.DataPreparation.load_path" href="#preparation.DataPreparation.load_path">load_path</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>